{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-12">
            <h1 class="mb-1">üîÑ Recurring Deposit</h1>
            <p class="text-muted">Automate your savings with recurring deposits</p>
        </div>
    </div>

    <!-- Main Form -->
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="glass-card">
                <form method="POST">
                    <!-- Account Selection -->
                    <div class="mb-3">
                        <label class="form-label">üí≥ Select Savings Account</label>
                        <select name="account_id" class="form-select" required>
                            <option selected disabled>Choose an account...</option>
                            {% for account in accounts %}
                            <option value="{{ account.id }}">
                                {{ account.account_number }} - {{ account.account_type }} (${{ "%.2f"|format(account.balance) }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Amount -->
                    <div class="mb-3">
                        <label class="form-label">üí∞ Deposit Amount</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" name="amount" class="form-control" placeholder="100" min="50" step="50" required>
                        </div>
                        <small class="text-muted">Minimum: $50</small>
                    </div>

                    <!-- Frequency -->
                    <div class="mb-3">
                        <label class="form-label">üìÖ Deposit Frequency</label>
                        <select name="frequency" class="form-select" required>
                            <option value="WEEKLY">Weekly</option>
                            <option value="MONTHLY" selected>Monthly</option>
                            <option value="QUARTERLY">Quarterly</option>
                            <option value="HALF_YEARLY">Half-Yearly</option>
                            <option value="YEARLY">Yearly</option>
                        </select>
                    </div>

                    <!-- Duration -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">‚è∞ Duration (Months)</label>
                            <input type="number" name="duration" class="form-control" placeholder="12" min="1" max="120" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">üíµ Total Amount</label>
                            <input type="text" class="form-control" id="totalAmount" disabled value="$0">
                        </div>
                    </div>

                    <!-- Calculation -->
                    <div class="alert alert-info">
                        <h6>üìä Calculation Summary</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <small class="d-block text-muted">Monthly Deposit</small>
                                <strong id="monthlyDeposit">$0</strong>
                            </div>
                            <div class="col-md-4">
                                <small class="d-block text-muted">Number of Deposits</small>
                                <strong id="numDeposits">0</strong>
                            </div>
                            <div class="col-md-4">
                                <small class="d-block text-muted">Expected Interest</small>
                                <strong id="expectedInterest">$0</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Maturity Amount -->
                    <div class="bg-success bg-opacity-10 p-3 rounded mb-4">
                        <h5>Expected Maturity Amount</h5>
                        <h3 class="text-success mb-0" id="maturityAmount">$0</h3>
                    </div>

                    <!-- Terms -->
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="terms" required>
                        <label class="form-check-label" for="terms">
                            I agree to the recurring deposit terms and conditions
                        </label>
                    </div>

                    <!-- Submit -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-check-circle me-2"></i>Set Up Recurring Deposit
                        </button>
                        <a href="{{ url_for('savings.savings_dashboard') }}" class="btn btn-outline-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Information Cards -->
    <div class="row mt-5">
        <div class="col-md-4">
            <div class="glass-card text-center">
                <i class="fas fa-shield-alt fa-3x text-success mb-3" style="color: #10b981;"></i>
                <h5>‚úÖ Secure</h5>
                <p class="text-muted">Your deposits are FDIC insured up to $250,000</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="glass-card text-center">
                <i class="fas fa-chart-line fa-3x text-info mb-3" style="color: #3b82f6;"></i>
                <h5>üìà Growing</h5>
                <p class="text-muted">Earn 4% annual interest on your recurring deposits</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="glass-card text-center">
                <i class="fas fa-clock fa-3x text-warning mb-3" style="color: #f59e0b;"></i>
                <h5>‚è±Ô∏è Flexible</h5>
                <p class="text-muted">Pause or cancel anytime with no penalties</p>
            </div>
        </div>
    </div>
</div>

<script>
// Calculator
document.querySelectorAll('input[name="amount"], input[name="duration"], select[name="frequency"]').forEach(el => {
    el.addEventListener('change', calculateTotal);
});

function calculateTotal() {
    const amount = parseFloat(document.querySelector('input[name="amount"]').value) || 0;
    const duration = parseFloat(document.querySelector('input[name="duration"]').value) || 12;
    const frequency = document.querySelector('select[name="frequency"]').value;
    
    let deposits = duration;
    if (frequency === 'WEEKLY') deposits = Math.floor(duration * 4.33);
    else if (frequency === 'QUARTERLY') deposits = Math.floor(duration / 3);
    else if (frequency === 'HALF_YEARLY') deposits = Math.floor(duration / 6);
    else if (frequency === 'YEARLY') deposits = Math.floor(duration / 12);
    
    const totalDeposited = amount * deposits;
    const interest = totalDeposited * 0.04 * (duration / 12); // 4% annual
    const maturity = totalDeposited + interest;
    
    document.getElementById('monthlyDeposit').textContent = '$' + amount.toFixed(2);
    document.getElementById('numDeposits').textContent = deposits;
    document.getElementById('expectedInterest').textContent = '$' + interest.toFixed(2);
    document.getElementById('totalAmount').value = '$' + totalDeposited.toFixed(2);
    document.getElementById('maturityAmount').textContent = '$' + maturity.toFixed(2);
}

// Initial calculation
calculateTotal();
</script>
{% endblock %}
